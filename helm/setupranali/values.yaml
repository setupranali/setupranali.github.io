# =============================================================================
# SetuPranali Helm Chart - Default Values
# =============================================================================
# For full documentation, see:
# https://setupranali.github.io/deployment/kubernetes/

# -----------------------------------------------------------------------------
# Image Configuration
# -----------------------------------------------------------------------------
image:
  repository: adeygifting/connector
  pullPolicy: IfNotPresent
  tag: ""  # Defaults to Chart appVersion

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# -----------------------------------------------------------------------------
# Replica Configuration
# -----------------------------------------------------------------------------
replicaCount: 2

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  annotations: {}
  name: ""

# -----------------------------------------------------------------------------
# Pod Configuration
# -----------------------------------------------------------------------------
podAnnotations: {}
podLabels: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# -----------------------------------------------------------------------------
# Service Configuration
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 8080
  annotations: {}

# -----------------------------------------------------------------------------
# Ingress Configuration
# -----------------------------------------------------------------------------
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: setupranali.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: setupranali-tls
  #    hosts:
  #      - setupranali.example.com

# -----------------------------------------------------------------------------
# Resource Limits
# -----------------------------------------------------------------------------
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 256Mi

# -----------------------------------------------------------------------------
# Autoscaling
# -----------------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# -----------------------------------------------------------------------------
# Health Checks
# -----------------------------------------------------------------------------
livenessProbe:
  httpGet:
    path: /v1/health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 15
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /v1/health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# -----------------------------------------------------------------------------
# Node Selection
# -----------------------------------------------------------------------------
nodeSelector: {}
tolerations: []
affinity: {}

# Pod Disruption Budget
podDisruptionBudget:
  enabled: true
  minAvailable: 1
  # maxUnavailable: 1

# -----------------------------------------------------------------------------
# SetuPranali Configuration
# -----------------------------------------------------------------------------
config:
  # Log level: DEBUG, INFO, WARNING, ERROR
  logLevel: INFO
  
  # CORS allowed origins (comma-separated)
  corsOrigins: "*"
  
  # Safety guards
  safetyGuards:
    enabled: true
    maxRows: 100000
    maxDimensions: 20
    maxMetrics: 50
    maxFilterDepth: 10
    timeoutSeconds: 30
  
  # Rate limiting
  rateLimit:
    enabled: true
    queryLimit: "100/minute"
    odataLimit: "200/minute"
    sourcesLimit: "10/minute"

# -----------------------------------------------------------------------------
# Secrets Configuration
# -----------------------------------------------------------------------------
secrets:
  # Encryption key for credentials (required)
  # Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
  encryptionKey: ""
  
  # Use existing secret instead of creating one
  existingSecret: ""
  
  # Key names in existing secret
  existingSecretKeys:
    encryptionKey: "UBI_SECRET_KEY"

# API Keys for authentication
apiKeys: []
  # - key: "pk_tenant1_xxx"
  #   tenant: "tenant1"
  #   role: "analyst"
  # - key: "pk_admin_xxx"
  #   tenant: "default"
  #   role: "admin"

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
redis:
  # Enable bundled Redis
  enabled: true
  
  # Redis architecture: standalone or replication
  architecture: standalone
  
  # Redis auth
  auth:
    enabled: false
    password: ""
  
  # Redis master configuration
  master:
    persistence:
      enabled: false
      size: 1Gi
    resources:
      limits:
        cpu: 250m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

# External Redis (if redis.enabled is false)
externalRedis:
  host: ""
  port: 6379
  password: ""
  # Use existing secret for password
  existingSecret: ""
  existingSecretKey: "redis-password"

# -----------------------------------------------------------------------------
# Catalog Configuration
# -----------------------------------------------------------------------------
catalog:
  # Inline catalog.yaml content
  # If empty, mount from ConfigMap or use default
  content: |
    # =============================================================================
    # SetuPranali Catalog Configuration
    # =============================================================================
    # Define your datasets, dimensions, metrics, and RLS rules here.
    # For documentation: https://setupranali.github.io/guides/datasets/
    
    datasets: []
    # Example:
    # datasets:
    #   - id: orders
    #     name: Orders
    #     description: Order-level transaction data
    #     source: my-warehouse
    #     table: fact_orders
    #     dimensions:
    #       - name: city
    #         expr: city_name
    #       - name: region
    #         expr: region_name
    #     metrics:
    #       - name: revenue
    #         expr: "SUM(amount)"
    #       - name: orders
    #         expr: "COUNT(*)"
    #     rls:
    #       mode: tenant_column
    #       field: tenant_id

  # Use existing ConfigMap for catalog
  existingConfigMap: ""

# -----------------------------------------------------------------------------
# Data Sources
# -----------------------------------------------------------------------------
# Configure data sources here or via API
sources: []
  # - name: my-warehouse
  #   type: snowflake
  #   connection:
  #     account: xxx.snowflakecomputing.com
  #     user: svc_bi
  #     warehouse: ANALYTICS_WH
  #     database: PROD
  #     schema: PUBLIC
  #   # Password from secret
  #   passwordSecret:
  #     name: warehouse-credentials
  #     key: password

# -----------------------------------------------------------------------------
# Extra Environment Variables
# -----------------------------------------------------------------------------
extraEnv: []
  # - name: MY_VAR
  #   value: "my-value"
  # - name: MY_SECRET
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: my-key

# -----------------------------------------------------------------------------
# Extra Volumes
# -----------------------------------------------------------------------------
extraVolumes: []
extraVolumeMounts: []

# -----------------------------------------------------------------------------
# Init Containers
# -----------------------------------------------------------------------------
initContainers: []

# -----------------------------------------------------------------------------
# Sidecar Containers
# -----------------------------------------------------------------------------
sidecars: []

